<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="keywords" content="壹木十行 安全 图片水印离线工具" />
    <meta name="description" content="壹木十行 安全 图片水印离线工具" />      
    <title>图片水印离线工具</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b93d6;
            --accent-color: #ff7e5f;
            --light-bg: #f8f9fa;
            --dark-text: #333;
            --light-text: #666;
            --border-color: #e1e5eb;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.12);
            --radius: 8px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--dark-text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        #container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 40px);
        }

        h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
            padding: 20px 30px;
            border-bottom: 2px solid var(--border-color);
            text-align: center;
            background: white;
        }

        article {
            background-color: #f0f5ff;
            padding: 15px 30px;
            font-size: 14px;
            color: var(--light-text);
            border-bottom: 1px solid var(--border-color);
        }

        article a {
            color: var(--accent-color);
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
        }

        article a:hover {
            text-decoration: underline;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .control-panel {
            flex: 0 0 500px;
            background-color: var(--light-bg);
            padding: 25px;
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
        }

        .preview-panel {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background-color: #fafafa;
        }

        .step-container {
            background-color: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        }

        .step-title {
            display: flex;
            align-items: center;
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            font-size: 13px;
            margin-right: 10px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
        }

        label {
            font-weight: 600;
            color: var(--dark-text);
            min-width: 100px;
            font-size: 14px;
        }

        input[type="file"] {
            padding: 10px;
            background-color: white;
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            width: 100%;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        input[type="file"]:hover {
            border-color: var(--secondary-color);
            background-color: #f8fbff;
        }

        input[type="text"], select {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            transition: var(--transition);
            flex: 1;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(107, 147, 214, 0.2);
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            background: #e0e5ec;
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
            transition: var(--transition);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--primary-color);
            transform: scale(1.1);
        }

        input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            padding: 0;
        }

        input[type="checkbox"], input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--secondary-color);
            cursor: pointer;
        }

        .value-label {
            display: inline-block;
            min-width: 50px;
            padding: 4px 8px;
            background-color: #f0f5ff;
            border-radius: 4px;
            font-weight: 600;
            color: var(--primary-color);
            text-align: center;
            font-size: 13px;
        }

        .checkbox-group, .radio-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 15px;
        }

        .checkbox-group label, .radio-group label {
            min-width: auto;
            font-weight: normal;
            font-size: 14px;
        }

        .control-section {
            background-color: white;
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border-color);
        }

        .download-section {
            background-color: #f8fff0;
            border: 1px solid #d4edda;
            padding: 20px;
            border-radius: var(--radius);
            margin-top: 10px;
        }

        .download-section .step-title {
            color: #28a745;
        }

        button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            background-color: #ff6b4a;
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .format-options {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 12px 0;
        }

        #graph {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        canvas {
            width: 100%;
            height: auto;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
            background-color: #f9f9f9;
        }

        canvas:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .quality-control {
            display: flex;
            align-items: center;
            margin-top: 12px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: var(--radius);
        }

        .footer-note {
            text-align: center;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            color: var(--light-text);
            font-size: 13px;
            background-color: white;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .preview-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .preview-count {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .empty-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #aaa;
            text-align: center;
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            background-color: #fcfcfc;
        }

        .empty-preview i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #d1d5db;
        }

        .empty-preview p {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .hint {
            font-size: 13px;
            color: #888;
            margin-top: 5px;
        }

        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .control-panel {
                flex: 0 0 auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                max-height: 60vh;
            }
            
            .preview-panel {
                flex: 1;
            }
        }

        @media (max-width: 768px) {
            #container {
                height: auto;
                min-height: calc(100vh - 40px);
            }
            
            .control-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            label {
                min-width: auto;
                margin-bottom: 5px;
            }
            
            input[type="text"], select, input[type="range"] {
                width: 100%;
            }
            
            #graph {
                grid-template-columns: 1fr;
            }
            
            .format-options {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        .icon {
            font-size: 18px;
            margin-right: 8px;
        }

        /* 滚动条样式 */
        .control-panel::-webkit-scrollbar,
        .preview-panel::-webkit-scrollbar {
            width: 6px;
        }

        .control-panel::-webkit-scrollbar-track,
        .preview-panel::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .control-panel::-webkit-scrollbar-thumb,
        .preview-panel::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        .control-panel::-webkit-scrollbar-thumb:hover,
        .preview-panel::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
<div id="container">

    <h1>图片水印离线工具</h1>

    <article>
        安全地添加图片水印, 无任何网络请求, 图片不会上传到服务器, 所有处理均在浏览器本地完成, 保障您的隐私安全
    </article>

    <div class="main-content">
        <!-- 左侧控制面板 -->
        <div class="control-panel">
            <div class="step-container">
                <div class="step-title">
                    <div class="step-number">1</div>
                    选择图片
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <label for="image">选择本地图片(可多选)</label>
                    </div>
                    <input type="file" id="image" autocomplete="off" multiple>
                    <div class="hint">支持PNG/JPG/WebP等格式，可一次选择多张图片</div>
                </div>
            </div>

            <div class="step-container">
                <div class="step-title">
                    <div class="step-number">2</div>
                    设置水印文字
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <input type="text" id="text" autocomplete="off" value="这里是水印文字">
                    </div>
                </div>
            </div>

            <div class="step-container">
                <div class="step-title">
                    <div class="step-number">3</div>
                    调整水印样式
                </div>
                
                <div class="control-group">
                    <div class="control-section">
                        <div class="section-title">基本样式</div>
                        <div class="control-row">
                            <label for="color">颜色:</label>
                            <input type="color" id="color" value="#100F0F">
                            <span class="value-label" id="label-color">#100F0F</span>
                        </div>
                        
                        <div class="control-row">
                            <label for="fontSelect">字体:</label>
                            <select id="fontSelect"></select>
                        </div>
                        
                        <div class="control-row" style="justify-content: space-between; margin-top: 10px;">
                            <div class="checkbox-group">
                                <input type="checkbox" id="bold" checked>
                                <label for="bold">加粗</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="italic">
                                <label for="italic">斜体</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="xx" checked>
                                <label for="xx">交错排列</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-section">
                        <div class="section-title">布局设置</div>
                        <div class="control-row">
                            <label for="alpha">不透明度:</label>
                            <input type="range" id="alpha" min="0" max="1" step="0.01" autocomplete="off" value="0.25">
                            <span class="value-label" id="label-alpha">0.25</span>
                        </div>
                        
                        <div class="control-row">
                            <label for="size">字号比例:</label>
                            <input type="range" id="size" min="0.1" max="5" step="0.01" autocomplete="off" value="0.8">
                            <span class="value-label" id="label-size">0.80</span>
                        </div>
                        
                        <div class="control-row">
                            <label for="radio">旋转角度:</label>
                            <input type="range" id="radio" min="-180" max="180" step="1" autocomplete="off" value="-30">
                            <span class="value-label" id="label-radio">-30°</span>
                        </div>
                    </div>
                    
                    <div class="control-section">
                        <div class="section-title">间距设置</div>
                        <div class="control-row">
                            <label for="marginHorizon">左右间隔:</label>
                            <input type="range" id="marginHorizon" min="-5" max="12" step="0.1" autocomplete="off" value="1.5">
                            <span class="value-label" id="label-marginHorizon">1.50</span>
                        </div>
                        
                        <div class="control-row">
                            <label for="marginVertical">上下间隔:</label>
                            <input type="range" id="marginVertical" min="-5" max="12" step="0.1" autocomplete="off" value="1.5">
                            <span class="value-label" id="label-marginVertical">1.50</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="download-section">
                <div class="step-title">
                    <div class="step-number">4</div>
                    下载选项
                </div>
                
                <div class="control-group">
                    <div class="control-row" style="justify-content: space-between; align-items: center;">
                        <label>点击右侧图片可单独下载</label>
                        <button onclick="downloadAllPic()">下载全部图片</button>
                    </div>
                    
                    <div class="format-options">

                        <div class="radio-group">
                            <input type="radio" value="image/png" name="pic-type" class="pic-type" checked id="png-format">
                            <label for="png-format">PNG格式</label>
                        </div>
                        
                        <div class="radio-group">
                            <input type="radio" value="image/jpeg" name="pic-type" class="pic-type" id="jpeg-format">
                            <label for="jpeg-format">JPEG格式</label>
                        </div>
                        
                        <div class="radio-group">
                            <input type="radio" value="image/webp" name="pic-type" class="pic-type" id="webp-format">
                            <label for="webp-format">WebP格式</label>
                        </div>
                    </div>
                    
                    <div id="pic-quality-div" class="quality-control" style="display: none">
                        <label for="pic-quality">图像质量:</label>
                        <input type="range" id="pic-quality" min="1" max="100" step="1" autocomplete="off" value="92">
                        <span class="value-label" id="label-pic-quality">92%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右侧预览面板 -->
        <div class="preview-panel">
            <div class="preview-header">
                <div class="preview-title">图片预览区</div>
                <div class="preview-count" id="preview-count">0 张图片</div>
            </div>
            
            <div id="graph">
            </div>
        </div>
    </div>

</div>

<script>
    let canvas;
    let $ = sel => document.querySelector(sel);
    let inputItems = ['color', 'alpha', "marginHorizon", "marginVertical", 'size', 'radio', "xx", "bold", "italic", "pic-quality"];
    let configInputSetting = {}; // 保存所有水印
    let allCanvas = []; // 保存所有的canvas

    let image = $('#image');
    let graph = $('#graph');
    let emptyPreview = $('#empty-preview');
    let previewCount = $('#preview-count');
    
    let dataURItoBlob = (dataURI, type) => {
        let i, _i, _ref;
        let binStr = atob((dataURI.split(','))[1]);
        let len = binStr.length;
        let arr = new Uint8Array(len);
        for (i = _i = 0, _ref = len - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
            arr[i] = binStr.charCodeAt(i);
        }
        return new Blob([arr], {
            type: type
        });
    };

    const fontOptions = ["Arial", "Helvetica", "Times New Roman", "Courier New", "Verdana", "Georgia", "Impact", "Tahoma", "Palatino", "Garamond", "Bookman", "Comic Sans MS", "Century Gothic", "Arial Black", "Lucida Console",
        "幼圆", "新宋体", "文泉驿微米黑", "微软正黑体", "微软雅黑", "宋体", "思源宋体", "思源黑体", "苹方", "隶书", "楷体", "开源字体", "华文中宋", "华文中宋", "华文行楷", "华文行楷", "华文新魏", "华文新魏", "华文细黑", "华文宋体", "华文宋体", "华文隶书", "华文隶书", "华文楷体", "华文楷体", "华文琥珀", "华文琥珀", "华文黑体", "华文仿宋", "华文仿宋", "华文彩云", "黑体", "汉仪雅酷黑W", "汉仪小麦体", "汉仪尚魏手书W", "汉仪旗黑", "汉仪旗黑", "汉仪旗黑", "汉仪乐喵体简", "汉仪楷体", "汉仪家书简", "汉仪黑荔枝", "汉仪大宋简", "汉仪大黑简", "汉仪程行体", "汉仪PP体简", "仿宋",];
    const selectElement = $("#fontSelect");
    // 遍历字体选项数组
    for (let i = 0; i < fontOptions.length; i++) {
        const optionElement = document.createElement("option");
        optionElement.value = fontOptions[i];
        optionElement.textContent = fontOptions[i];
        optionElement.style.fontFamily = fontOptions[i];
        selectElement.appendChild(optionElement);
    }

    const redrawCanvas = (canvas, img) => {
        // 重新设置canvas的宽高, 会清空画布
        let w = canvas.width;
        let h = canvas.height;
        canvas.width = w;
        canvas.height = h;
        canvas.getContext('2d').drawImage(img, 0, 0);
    };

    const downloadCanvasAsImage = (canvas, fileName) => {
        let type = configInputSetting["pic-type"] ? configInputSetting["pic-type"] : "image/png";
        let link = document.createElement('a');
        link.download = fileName.replace(/\.[^/.]+$/, "") + "_watermark." + type.split("/")[1];
        let imageData = canvas.toDataURL(type, parseFloat($("#pic-quality").value) / 100);
        let blob = dataURItoBlob(imageData, type);
        link.href = URL.createObjectURL(blob);
        graph.appendChild(link);
        return setTimeout(function () {
            link.click();
            return graph.removeChild(link);
        }, 10);
    }
    
    const downloadAllPic = async () => {
        if (allCanvas.length === 0) {
            alert("请先选择图片！");
            return;
        }
        
        allCanvas.forEach(({canvas, img, fileName}) => {
            downloadCanvasAsImage(canvas, fileName);
        });
        
        // 显示下载提示
        let downloadMsg = document.createElement('div');
        downloadMsg.style.cssText = 'position:fixed;top:20px;right:20px;background:#28a745;color:white;padding:15px;border-radius:8px;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,0.2);';
        downloadMsg.innerHTML = `正在下载 ${allCanvas.length} 张图片...`;
        document.body.appendChild(downloadMsg);
        
        setTimeout(() => {
            document.body.removeChild(downloadMsg);
        }, 3000);
    }
    
    let readFile = file => {
        if (file == null) {
            return;
        }
        let fileReader = new FileReader;
        fileReader.onload = function () {
            let img = new Image;
            img.onload = function () {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                let ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);

                allCanvas.push({img: img, canvas: canvas, fileName: file.name});

                drawText(canvas, img);
                graph.appendChild(canvas);

                // 更新预览计数
                previewCount.textContent = allCanvas.length + " 张图片";

                // 添加点击下载事件
                canvas.addEventListener('click', () => {
                    downloadCanvasAsImage(canvas, file.name);
                    
                    // 显示下载提示
                    let downloadMsg = document.createElement('div');
                    downloadMsg.style.cssText = 'position:fixed;top:20px;right:20px;background:#28a745;color:white;padding:15px;border-radius:8px;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,0.2);';
                    downloadMsg.innerHTML = '正在下载图片...';
                    document.body.appendChild(downloadMsg);
                    
                    setTimeout(() => {
                        document.body.removeChild(downloadMsg);
                    }, 2000);
                });
            };
            return img.src = fileReader.result;
        };
        return fileReader.readAsDataURL(file);
    };
    
    const makeStyle = () => {
        let match = configInputSetting.color.value.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);
        return 'rgba(' + (parseInt(match[1], 16)) + ',' + (parseInt(match[2], 16)) + ',' + (parseInt(match[3],
            16)) + ',' + configInputSetting.alpha.value + ')';
    };

    const drawText = (canvas, img) => {
        redrawCanvas(canvas, img);
        if (canvas == null) {
            return;
        }

        let textSize = configInputSetting.size.value * Math.max(15, (Math.min(canvas.width, canvas.height)) / 25);
        let textCtx = canvas.getContext('2d');
        textCtx.fillStyle = makeStyle();

        textCtx.font = ($("#bold").checked ? "bold " : "") + ($("#italic").checked ? "italic " : "") + textSize + "px " + $("#fontSelect").value;

        let baseWidth = (textCtx.measureText('啊')).width;

        let textWidth = (textCtx.measureText(configInputSetting.text.value)).width;
        let xAdd = textWidth + configInputSetting.marginHorizon.value * baseWidth;
        let yAdd = textWidth + configInputSetting.marginVertical.value * baseWidth;
        xAdd = Math.max(xAdd, 10);
        yAdd = Math.max(yAdd, 10);

        let border = 500;
        for (let i = -1 * border; i < canvas.width + border; i += xAdd) {
            for (let j = -1 * border, jj = 0; j < canvas.height + border; j += yAdd, jj++) {
                textCtx.save();
                textCtx.translate(i + Math.ceil(jj % 2 === 0 ? xAdd / (configInputSetting.xx.checked ? 2 : 1) : 0), j);
                textCtx.rotate(configInputSetting.radio.value * Math.PI / 180);
                textCtx.fillText(configInputSetting.text.value, 0, 0);
                textCtx.restore();
            }
        }
    };

    let picTypeInputs = document.getElementsByClassName("pic-type");
    for (let i = 0; i < picTypeInputs.length; i++) {
        let item = picTypeInputs[i];
        item.addEventListener('change', () => {
            let picQuality = $("#pic-quality-div");
            picQuality.style.display = "none";
            if (item.checked) {
                configInputSetting["pic-type"] = item.value;
                if ("image/webp" === item.value || "image/jpeg" === item.value) {
                    picQuality.style.display = "flex";
                }
            }
        });
    }

    image.addEventListener('change', function () {
        // 清除之前的图片
        while (graph.firstChild) {
            graph.removeChild(graph.firstChild);
        }
        allCanvas = [];
        
        // 处理批量图片
        const batchFileHandler = file => {
            const type = file.type;
            if (!['image/png', 'image/jpeg', 'image/webp'].includes(type)) {
                return alert('仅支持 png, jpg, webp 图片格式');
            }
            readFile(file);
        };
        [...this.files].forEach(batchFileHandler);
    });

    configInputSetting["text"] = $('#text');
    configInputSetting["text"].addEventListener('input', () => {
        allCanvas.forEach(({canvas, img}) => drawText(canvas, img));
    });

    configInputSetting["fontSelect"] = $('#fontSelect');
    configInputSetting["fontSelect"].addEventListener('change', () => {
        allCanvas.forEach(({canvas, img}) => drawText(canvas, img));
    });

    // 初始化所有输入控件
    inputItems.forEach(item => {
        let el = $('#' + item);
        configInputSetting[item] = el;
        let labelDom = "#label-" + item;
        
        // 设置初始显示值
        if ($(labelDom)) {
            if (item === 'radio') {
                $(labelDom).innerText = parseFloat(el.value).toFixed(0) + '°';
            } else if (item === 'alpha' || item === 'size' || item === 'marginHorizon' || item === 'marginVertical') {
                $(labelDom).innerText = parseFloat(el.value).toFixed(2);
            } else if (item === 'pic-quality') {
                $(labelDom).innerText = parseFloat(el.value).toFixed(0) + '%';
            } else if (item === 'color') {
                $(labelDom).innerText = el.value;
            }
        }
        
        return el.addEventListener('input', () => {
            if ($(labelDom)) {
                if (item === 'radio') {
                    $(labelDom).innerText = parseFloat(el.value).toFixed(0) + '°';
                } else if (item === 'alpha' || item === 'size' || item === 'marginHorizon' || item === 'marginVertical') {
                    $(labelDom).innerText = parseFloat(el.value).toFixed(2);
                } else if (item === 'pic-quality') {
                    $(labelDom).innerText = parseFloat(el.value).toFixed(0) + '%';
                } else if (item === 'color') {
                    $(labelDom).innerText = el.value;
                }
            }
            
            allCanvas.forEach(({canvas, img}) => {
                drawText(canvas, img);
            });
        });
    });
    
    // 初始化颜色标签显示
    $("#label-color").innerText = $("#color").value;
    
    // 页面加载时显示一个示例
    window.addEventListener('DOMContentLoaded', () => {
        // 默认选择第一个字体
        if (fontOptions.length > 0) {
            $("#fontSelect").value = fontOptions[0];
        }
        
        // 创建示例图片
        const createExampleImage = (name, width, height, color, text) => {
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            
            // 绘制背景
            ctx.fillStyle = color;
            ctx.fillRect(0, 0, width, height);
            
            // 绘制文字
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, width/2, height/2);
            
            // 绘制边框
            ctx.strokeStyle = '#e1e5eb';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, width, height);
            
            return canvas.toDataURL('image/png');
        };
        
        // 示例图片
        const exampleImage1 = createExampleImage("示例图片1", 600, 400, '#4a6fa5', '示例图片 1');
        const exampleImage2 = createExampleImage("示例图片2", 600, 400, '#6b93d6', '示例图片 2');
        
        // 将示例添加到文件选择器中
        const dataUrlToFile = (dataUrl, filename) => {
            const arr = dataUrl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while(n--){
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new File([u8arr], filename, {type:mime});
        };
        
        // 创建示例文件
        const file1 = dataUrlToFile(exampleImage1, "示例图片1.png");
        const file2 = dataUrlToFile(exampleImage2, "示例图片2.png");
        
        // 模拟选择示例文件
        setTimeout(() => {
            readFile(file1);
            readFile(file2);
        }, 500);
    });






</script>
</body>
</html>